return {
  "mfussenegger/nvim-jdtls",

  config = function()
    -- âš™ï¸ Ne dÃ©marre JDTLS que pour les fichiers Java
    if vim.bo.filetype ~= "java" then
      return
    end

    -- ğŸ” DÃ©tection du dossier racine du projet
    local root_dir = vim.fs.root(0, { "gradlew", ".git", "mvnw" }) or vim.fn.getcwd()

    -- ğŸš« Ignore les projets Flutter
    if vim.fn.filereadable(root_dir .. "/pubspec.yaml") == 1 then
      return
    end

    -- ğŸ§© Configuration de la commande jdtls
    local cmd = { vim.fn.exepath("jdtls") }
    if pcall(require, "lazy") and require("lazy").has("mason.nvim") then
      local lombok_jar = vim.fn.expand("$MASON/share/jdtls/lombok.jar")
      table.insert(cmd, string.format("--jvm-arg=-javaagent:%s", lombok_jar))
    end

    -- ğŸ“ Fonctions utilitaires pour jdtls
    local function project_name(dir)
      return dir and vim.fs.basename(dir)
    end

    local function jdtls_config_dir(name)
      return vim.fn.stdpath("cache") .. "/jdtls/" .. name .. "/config"
    end

    local function jdtls_workspace_dir(name)
      return vim.fn.stdpath("cache") .. "/jdtls/" .. name .. "/workspace"
    end

    local pname = project_name(root_dir)
    local final_cmd = vim.deepcopy(cmd)
    if pname then
      vim.list_extend(final_cmd, {
        "-configuration",
        jdtls_config_dir(pname),
        "-data",
        jdtls_workspace_dir(pname),
      })
    end

    -- ğŸš€ DÃ©marrage ou attachement de JDTLS
    require("jdtls").start_or_attach({
      name = "jdtls",
      cmd = final_cmd,
      root_dir = root_dir,
      settings = {
        java = {
          inlayHints = {
            parameterNames = { enabled = "all" },
          },
        },
      },
      init_options = {
        bundles = {},
      },
      dap = { hotcodereplace = "auto", config_overrides = {} },
      dap_main = {},
      test = true,
    })
  end,
}
